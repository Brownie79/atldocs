
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Getting Started &#8212; Alpha Trading Labs DSL documentation  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Alpha Trading Labs DSL" href="atomlib.html" />
    <link rel="prev" title="Using Alpha Trading Labs" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="getting-started">
<span id="gs"></span><h1><strong>Getting Started</strong><a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>Use this page to get acquainted with Alpha Trading Labs. This will be helpful as a reference to guide you
in setting up your model as well as writing a valuation function for a model. If you have never used
Alpha Trading Labs before, go through the entirety of this document, otherwise skip to the section
which you need.</p>
<ul class="simple">
<li><a class="reference internal" href="#tutorial"><span class="std std-ref">Tutorial</span></a><ul>
<li><a class="reference internal" href="#acquainted"><span class="std std-ref">Getting Aquainted</span></a></li>
<li><a class="reference internal" href="#model"><span class="std std-ref">Understanding the Model</span></a></li>
<li><a class="reference internal" href="#multmodels"><span class="std std-ref">Create Multiple Models at Once</span></a></li>
<li><a class="reference internal" href="#save"><span class="std std-ref">Save and Find Your Models</span></a></li>
</ul>
</li>
<li><a class="reference internal" href="#summaryresults"><span class="std std-ref">What the Results Summary Means</span></a></li>
<li><a class="reference internal" href="#modelparameters"><span class="std std-ref">Model Parameters</span></a></li>
<li><a class="reference internal" href="#tcparameters"><span class="std std-ref">Trading Column Parameters</span></a></li>
<li><a class="reference internal" href="#valuationfunc"><span class="std std-ref">Valuation Functions</span></a></li>
<li><a class="reference internal" href="#whyusehold"><span class="std std-ref">Why Use Hold</span></a></li>
</ul>
<div class="section" id="tutorial">
<span id="id1"></span><h2><strong>Tutorial</strong><a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<p>This tutorial is a quick guide on how to create and test a model on Alpha Trading Labs.
You will of course need an account and need to be signed into the site.</p>
<ul class="simple">
<li>Click on “New Startegy” on the top left to get started.</li>
</ul>
<div class="section" id="getting-aquainted">
<span id="acquainted"></span><h3><strong>Getting Aquainted</strong><a class="headerlink" href="#getting-aquainted" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>You will be met with the main editing page of for your model, it should look something like this:</li>
</ul>
<img alt="_images/1_start.png" src="_images/1_start.png" />
<ul class="simple">
<li>The code you see is the default set up for a working model. We will now test it so you can start to get
a feel on how the site works.</li>
<li>First thing you will want to do is name your strategy, you can do this by clicking on “Startegy Name”<ul>
<li>for this tutorial you can simply use “Tutorial”</li>
</ul>
</li>
</ul>
<img alt="_images/2_name.png" src="_images/2_name.png" />
<ul class="simple">
<li>Now click on “SAVE”, you should see a green box on the top right highlighting that you have saved your
startegy.<ul>
<li>Note: as you edit your model it should auto save however it is always a good habit to manually save after any edit</li>
</ul>
</li>
</ul>
<img alt="_images/3_save.png" src="_images/3_save.png" />
<ul class="simple">
<li>Lets test the default model, click on “RUN A BACKTEST” next to the save button</li>
<li>You should be met with a window that looks like this:</li>
</ul>
<img alt="_images/4_runtest.png" src="_images/4_runtest.png" />
<ul class="simple">
<li>Choose whether you want to do a “Quicktest” or “Backtest”<ul>
<li>Quicktest will not use market data but will execute quicker</li>
<li>Backtest will use market data but will take longer</li>
<li>Note: If you Backtest you can only do 1 day</li>
</ul>
</li>
<li>For the tutorial leave “Quicktest”</li>
<li>Set you Backtest Period<ul>
<li>Choose the start date</li>
<li>Choose the number of days to run the test starting from the start date</li>
</ul>
</li>
<li>For the tutorial we will leave the default date and 1 trading day</li>
<li>Select a Timeframe<ul>
<li>Depending on your model you may not want to test a full trading day. You can set the times between
9.30am to 4.00pm EST in which you want to run your test</li>
</ul>
</li>
<li>For the tutorial we will leave “full trading day” selected</li>
<li>Click on “START BACKTEST”</li>
<li>Wait for the model to run</li>
<li>After a few seconds you should be met with a screen similar to this:</li>
</ul>
<img alt="_images/5_backtest.png" src="_images/5_backtest.png" />
<ul class="simple">
<li>These are the results from running the model<ul>
<li>For more information on what the results mean go to <a class="reference internal" href="#summaryresults"><span class="std std-ref">What the Results Summary Means</span></a></li>
</ul>
</li>
<li>This summary should tell you whether or not your model is successful</li>
</ul>
</div>
<div class="section" id="understanding-the-model">
<span id="model"></span><h3><strong>Understanding the Model</strong><a class="headerlink" href="#understanding-the-model" title="Permalink to this headline">¶</a></h3>
<p>Now that you are familiar with the how to maneuver the basics of the site let’s look at the model,
how it is structured and what each part means</p>
<ul class="simple">
<li>The model is has four basic parts to it</li>
</ul>
<ol class="arabic simple">
<li>The first is the imports and initialization, highlighted here:</li>
</ol>
<img alt="_images/6_important.png" src="_images/6_important.png" />
<ul class="simple">
<li>These lines are necessary to create and run the model, you should leave these lines as there are<ul>
<li>Pipeline sets up your model and its parameters</li>
<li>Signal evaluates the given valuation function</li>
<li>marketlib is a library of helper and valuation function you can use ( <a class="reference internal" href="marketlib.html#ml"><span class="std std-ref">Marketlib</span></a> )</li>
</ul>
</li>
</ul>
<ol class="arabic simple" start="2">
<li>The next part consists of setting up the model parameters, highlighted here:</li>
</ol>
<img alt="_images/7_modelParameters.png" src="_images/7_modelParameters.png" />
<ul class="simple">
<li>Here you can set up your model by overriding the default parameters, in order for the model to meet
your needs<ul>
<li>for example set yourself as the author:</li>
</ul>
</li>
</ul>
<img alt="_images/11_changeParameters.png" src="_images/11_changeParameters.png" />
<ul class="simple">
<li>Go to <a class="reference internal" href="#modelparameters"><span class="std std-ref">Model Parameters</span></a> to see all the parameters you can set and what they mean</li>
</ul>
<ol class="arabic simple" start="3">
<li>The third part consists of the trading column parameters, highlighted here:</li>
</ol>
<img alt="_images/8_tradingcolumnParameters.png" src="_images/8_tradingcolumnParameters.png" />
<ul class="simple">
<li>These parameters are very important as they will determine important factors in your trading model such as<ul>
<li>What security symbol to trade</li>
<li>Order size</li>
<li>Trading strategies</li>
<li>And many more</li>
<li>For example, change the security symbol you want to trade:</li>
</ul>
</li>
</ul>
<img alt="_images/12_changeParameters.png" src="_images/12_changeParameters.png" />
<ul class="simple">
<li>To see all the parameters you can change in your trading column see <a class="reference internal" href="#tcparameters"><span class="std std-ref">Trading Column Parameters</span></a></li>
<li>You can also see all the parameters and what they do on the right hand side of the editing view:</li>
</ul>
<img alt="_images/10_parameters.png" src="_images/10_parameters.png" />
<ol class="arabic simple" start="4">
<li>Finally you have the part that actually creates your model, highlighted here:</li>
</ol>
<img alt="_images/9_initializeModelwithValuation.png" src="_images/9_initializeModelwithValuation.png" />
<ul>
<li><p class="first">The most important part of this, what is inside of Signal() is the only thing you should change from these two
lines</p>
<ul>
<li><p class="first">Signal interprets your valuation function as such:</p>
<p><strong>Signal(valuation Function, *arguments valuation function takes)</strong></p>
</li>
<li><p class="first">By default the model uses MP2 a valuation function included in <a class="reference internal" href="marketlib.html#ml"><span class="std std-ref">Marketlib</span></a>, where “NSDQ:IWM” and exp=2
are the arguments being passed into MP2</p>
</li>
</ul>
</li>
<li><p class="first">Now you can write your own valuation function and replace MP2 with it, passing whatever arguments your
function might take.</p>
<ul class="simple">
<li>For example, lets use MP2 (the defualt valuation function already passed in Signal). If we were to have
written this valuation function ourselves we could put it in the model like this:</li>
</ul>
</li>
</ul>
<img alt="_images/18_customValuationFunction.png" src="_images/18_customValuationFunction.png" />
<ul class="simple">
<li>Again, make sure to update Signal with your new valuation function and its arguments.<ul>
<li>In this case since were still using MP2 there is no need to change it</li>
</ul>
</li>
<li>For more information on writing your own valuation function and understanding how the DSL can help you
write a function such as MP2 see <a class="reference internal" href="#valuationfunc"><span class="std std-ref">Valuation Functions</span></a></li>
</ul>
</div>
<div class="section" id="create-multiple-models-at-once">
<span id="multmodels"></span><h3><strong>Create Multiple Models at Once</strong><a class="headerlink" href="#create-multiple-models-at-once" title="Permalink to this headline">¶</a></h3>
<p>Now that you know the basics about how the model works here is an additional trick to help you create multiple
models using the same valuation function but with different parameters.</p>
<ul class="simple">
<li>Go to the trading column parameters for any given parameter add a second value in the form of a list like this:</li>
</ul>
<img alt="_images/13_playWithParameters.png" src="_images/13_playWithParameters.png" />
<ul>
<li><p class="first">This will create two models where one has the EntryEdge set to 100 and the second to 200, and all the other
paramters remain the same.</p>
<ul class="simple">
<li>you can do this with all parameters at the same time, where the first element in the list of the given parameters
will be the value for the first model, the second values in the lists for the second model etc.</li>
<li>the number of models generated will be equal to the length of the longest list of arguments in a given parameter</li>
<li>Note: don’t add too many arguments, where it would be wise to keep it to 2 arguments</li>
</ul>
</li>
<li><p class="first">For this tutorial we will keep it simple and only add a second argument to “EntryEdge”</p>
<ul class="simple">
<li>Note: we kept the changed Order and Quite symbol ‘NOK’</li>
<li>If you run the model with NOK don’t forget to also change Signal to:</li>
</ul>
<p><strong>Signal(MP2, ‘NSDQQ:NOK’, exp=2.0)</strong></p>
</li>
<li><p class="first">Same as before click “RUN BACKTEST” and set up your test</p>
<ul class="simple">
<li>Again we will keep all the default values for this tutorial</li>
</ul>
</li>
<li><p class="first">You should now see something similar to this:</p>
</li>
</ul>
<img alt="_images/14_resultsMultipleParameters.png" src="_images/14_resultsMultipleParameters.png" />
<ul class="simple">
<li>As you can see there are now two sets of results which you can compare side by side</li>
<li>You can also see them individually and with more details if you go to the “GENERATED MODELS” tab on top:</li>
</ul>
<img alt="_images/15_multipleGeneratedModels.png" src="_images/15_multipleGeneratedModels.png" />
<ul class="simple">
<li>The graph may look like a single graph if the models are similar but it is actually displaying both models</li>
<li>you zoom into a the graph by reducing the timeframe</li>
<li>Full graph:</li>
</ul>
<img alt="_images/16_twoGraphs.png" src="_images/16_twoGraphs.png" />
<ul class="simple">
<li>Zoomed Graph, where you can now see the difference between the two models:</li>
</ul>
<img alt="_images/17_zoom.png" src="_images/17_zoom.png" />
</div>
<div class="section" id="use-your-own-valuation-function">
<span id="creatingvaluation"></span><h3><strong>Use your own Valuation Function</strong><a class="headerlink" href="#use-your-own-valuation-function" title="Permalink to this headline">¶</a></h3>
<p>Now that you know how to change the parameters, whenever you are ready to write and use your
own valuation function</p>
<img alt="_images/18_customValuationFunction.png" src="_images/18_customValuationFunction.png" />
</div>
<div class="section" id="save-and-find-your-models">
<span id="save"></span><h3><strong>Save and Find Your Models</strong><a class="headerlink" href="#save-and-find-your-models" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>You can now find your saved strategies, as well as any generated models created from running a backtest, on the
“My Strategies” tab on top:</li>
</ul>
<img alt="_images/19_newOrPastStrategies.png" src="_images/19_newOrPastStrategies.png" />
<ul class="simple">
<li>As you can see there are three “tutorial” models to click here, the first one being the one we generated with
all the default parameters, and the other two are the generated models from when we rant the multiple
parameters in one go:</li>
</ul>
<img alt="_images/20_allPreviousBacktests.png" src="_images/20_allPreviousBacktests.png" />
<p>You should now be familiar with how to navigate the application and how to create a model. You are now ready to
create your own strategies and write your own valuation function. Use the more detailed information below as well
as the information on <a class="reference internal" href="atomlib.html#al"><span class="std std-ref">Alpha Trading Labs DSL</span></a> and <a class="reference internal" href="marketlib.html#ml"><span class="std std-ref">Marketlib</span></a></p>
</div>
</div>
<div class="section" id="what-the-results-summary-means">
<span id="summaryresults"></span><h2><strong>What the Results Summary Means</strong><a class="headerlink" href="#what-the-results-summary-means" title="Permalink to this headline">¶</a></h2>
<img alt="_images/5_backtest.png" src="_images/5_backtest.png" />
<p>Here is a brief summary of what all the results actually mean:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Definition</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Total PNL</td>
<td>total Profit or Loss (open + closed)</td>
</tr>
<tr class="row-odd"><td>Closed PNL</td>
<td>amount sold (profit or loss on closed positions)</td>
</tr>
<tr class="row-even"><td>Open PNL</td>
<td>amount of profit or loss of still open positions at the time model ended</td>
</tr>
<tr class="row-odd"><td>Net Rebates</td>
<td>Trading Rebates - Trading Fees</td>
</tr>
<tr class="row-even"><td>Drawdown</td>
<td>Difference between the last peak and the ending price of the security</td>
</tr>
<tr class="row-odd"><td>Model PNL</td>
<td>Total profit or loss of the model (Total PNL + Net Rebates)</td>
</tr>
<tr class="row-even"><td>Max Notional</td>
<td>How much was invested on the model</td>
</tr>
<tr class="row-odd"><td>% Return</td>
<td>% return of investments (Model PNL / Max Notional)</td>
</tr>
<tr class="row-even"><td>Sharpe Ratio</td>
<td>Volatility of the model</td>
</tr>
<tr class="row-odd"><td>Fills</td>
<td>Total executed buy and sell orders</td>
</tr>
<tr class="row-even"><td>Transactions</td>
<td>Total requested transactions</td>
</tr>
<tr class="row-odd"><td>Transactions per Fills</td>
<td>Transactions / Fills</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="model-parameters">
<span id="modelparameters"></span><h2><strong>Model Parameters</strong><a class="headerlink" href="#model-parameters" title="Permalink to this headline">¶</a></h2>
<img alt="_images/7_modelParameters.png" src="_images/7_modelParameters.png" />
<p>Here are the model parameters you can change:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">Author</span> <span class="o">=</span> <span class="s1">&#39;Author Unknown&#39;</span><span class="p">,</span>
        <span class="n">Description</span> <span class="o">=</span> <span class="s1">&#39;No Description&#39;</span><span class="p">,</span>
        <span class="n">ModelName</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span><span class="p">,</span>
        <span class="n">MaxDrawdown</span> <span class="o">=</span> <span class="mi">65000</span><span class="p">,</span>
        <span class="n">MarkupToMidpt</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
        <span class="n">ModelControlGroup</span> <span class="o">=</span> <span class="s1">&#39;AlphaLabs | Test | |&#39;</span><span class="p">,</span>
        <span class="n">userlib_filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
          <span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Author:</strong> Your name as “Firstname Lastname”</li>
<li><strong>Description:</strong> Description of the model, what you want it to achieve and how.</li>
<li><strong>Model Name:</strong> Name of your model.</li>
<li><strong>Max Drawdown:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> D=Maximum loss your model can have. This is an integer value in dollar amount.
When the model drawdown value reaches this limit, the model will be moved to exit mode. In exit mode,
if the net position of the model is zero, it will cancel all the outstanding orders. This parameter is
not used while back testing the model.</li>
<li><strong>Markup To Midpoint:</strong> <strong>TO BE IMPLEMENTED, do not change</strong></li>
<li><strong>Model Control Group:</strong> <strong>TO BE IMPLEMENTED, do not change</strong></li>
<li><strong>User Library Filename:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> The absolute path to your library file containing your personally defined algorithms.</li>
</ul>
</div>
<div class="section" id="trading-column-parameters">
<span id="tcparameters"></span><h2><strong>Trading Column Parameters</strong><a class="headerlink" href="#trading-column-parameters" title="Permalink to this headline">¶</a></h2>
<img alt="_images/8_tradingcolumnParameters.png" src="_images/8_tradingcolumnParameters.png" />
<p>Here are the Trading Column Parameters that you can manipulate in order for your model to behave
in the way that you want it to.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">config_tc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">EdgeUnitsMultiplier</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">EdgeUnitsPerTick</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">OrdersPerSide</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">OrderSpacing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">OrderSpacingInTicks</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
        <span class="n">MinOrderSize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">OrderSize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">OrderSizeInc</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">PartialOrderMode</span> <span class="o">=</span> <span class="s1">&#39;FULL&#39;</span><span class="p">,</span>
        <span class="n">PreserveRoundness</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
        <span class="n">WorkingEdge</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">PosMax</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
        <span class="n">PosMaxNewOrders</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
        <span class="n">PosNormal</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
        <span class="n">EntryEdge</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">EntryEdgeInc</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">ExitEdge</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">ExitEdgeInc</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">PosEntryEdge</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">PosExitEdge</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">PosEdge</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">EntryRoundingMode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">ExitRoundingMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">ExitColumnMode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">PortfolioPosEdge</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">PortfolioPosDenominator</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">PortfolioBeta</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">AddingOrderType</span> <span class="o">=</span> <span class="s1">&#39;ALO&#39;</span><span class="p">,</span>
        <span class="n">MaxEdge</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>
        <span class="n">MaxPriceImprovement</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">MinJoinVolume</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">OrderDelay</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">MinOrderHitTake</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
        <span class="n">RemovalEntryEdge</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">RemovalExitEdge</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">RemovalOrderType</span> <span class="o">=</span> <span class="s1">&#39;IOC&#39;</span><span class="p">,</span>
        <span class="n">CancelDelay</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">PairBeta</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">PairDenom</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">PairEdge</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">BidsOnly</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
        <span class="n">AsksOnly</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
        <span class="n">PairColumnType</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">Strategy</span> <span class="o">=</span> <span class="s1">&#39;2 Sided Market Making&#39;</span><span class="p">,</span>
        <span class="n">TradingEnabled</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
        <span class="n">OrderVenue</span><span class="o">=</span><span class="s1">&#39;NSDQ&#39;</span><span class="p">,</span>
        <span class="n">OrderSymbol</span><span class="o">=</span><span class="s1">&#39;GRPN&#39;</span><span class="p">,</span>
        <span class="n">QuoteVenue</span><span class="o">=</span><span class="s1">&#39;NSDQ&#39;</span><span class="p">,</span>
        <span class="n">QuoteSymbol</span><span class="o">=</span><span class="s1">&#39;GRPN&#39;</span><span class="p">,</span>
        <span class="n">PairVenue</span><span class="o">=</span><span class="s1">&#39;NSDQ&#39;</span><span class="p">,</span>
        <span class="n">PairSymbol</span><span class="o">=</span><span class="s1">&#39;GRPN&#39;</span><span class="p">,</span>
         <span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p class="first"><strong>Edge Unit Multiplier”</strong> This parameter is used to convert the stock price in decimal
to an integer value. If the price of the security is represented in 2 decimals
(for example as $123.45), the edge unit multiplier should be set to 100. The default value
of this parameter should be 100</p>
</li>
<li><p class="first"><strong>Edge Units Per Tick:</strong> EdgeUnitsPerTick indicates number of units we want to have per tick.
For example if a stock price ticks by $0.01, we would need edge unit multiplier as 100. And for
the same stock, if the valuation function is expected to return a valuation price in milli pennies
such as $123.45678, then EdgeUnitsPerTick should be set to 1000.</p>
</li>
<li><p class="first"><strong>Order Per Side:</strong> The parameter OrdersPerSide is used to set the maximum number of orders a
trading column can place on a bid side and/or on offer side. However only one order can be placed on
one price level. Valid values for this parameters are from 1 to 5</p>
</li>
<li><p class="first"><strong>Order Spacing:</strong> <strong>TO BE IMPLEMENTED, do not change</strong></p>
</li>
<li><p class="first"><strong>Order Spacing In Ticks:</strong> <strong>TO BE IMPLEMENTED, do not change</strong></p>
</li>
<li><p class="first"><strong>Min Order Size:</strong> <strong>TO BE IMPLEMENTED, do not change</strong></p>
</li>
<li><p class="first"><strong>Order Size:</strong> Indicates minimum size of an order.</p>
</li>
<li><p class="first"><strong>Order Size Inc:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> Default value of this parameter
should be 100. This parameter is used to manually increase the order size through a GUI control.</p>
</li>
<li><p class="first"><strong>Partial Order Mode:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> default value of this parameter is “FULL”.</p>
</li>
<li><p class="first"><strong>Preserve Roundness:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> default value of this parameter is False.</p>
</li>
<li><p class="first"><strong>Working Edge:</strong> WorkingEdge is used while calculating bid and offer price. This will be added to ask
price to get the good ask price. And will subtracted from bid price to get a good bid price. It is used
both while entering and exiting a position.</p>
</li>
<li><p class="first"><strong>Pos Max:</strong> This parameter PosMax indicated the maximum position a trading column can have.</p>
</li>
<li><p class="first"><strong>Pos Max New Orders:</strong> <strong>TO BE IMPLEMENTED, do not change</strong></p>
</li>
<li><p class="first"><strong>Pos Normal:</strong> This parameter would contain a value between 0 and PosMax. PosEntryEdge, PosExitEdge, and PosEdge
parameter values will be applied in full after the position reaches the value set for this parameter. Until the
total position reaches this PosNormal value, PosEntryEdge, PosExitEdge and PosEdge will be applied in proportion
to the position.</p>
</li>
<li><p class="first"><strong>Entry Edge:</strong> EntryEdge is applied to bid and ask price while entering a position.</p>
</li>
<li><p class="first"><strong>Entry Edge Inc:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> Default value of this parameter
should be 10. This parameter is used to manually increase the EntryEdge value through a GUI control.</p>
</li>
<li><p class="first"><strong>Exit Edge:</strong> ExitEdge is applied to bid and ask price while exiting a position.</p>
</li>
<li><p class="first"><strong>Exit Edge Inc:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> Default value of this parameter
should be 10. This parameter is used to manually increase the ExitEdge value through a GUI control.</p>
</li>
<li><p class="first"><strong>Pos Entry Edge:</strong> PosEntryEdge is applied to bid and ask price while entering a position. PosEntryEdge
will be added proportionately based on the position that has been acquired.</p>
</li>
<li><p class="first"><strong>Pos Exit Edge:</strong> PosExitEdge is applied to bid and ask price while exiting a position. Similar to PosEntryEdge,
PosExitEdge will be added proportionately based on the position that has been acquired.</p>
</li>
<li><p class="first"><strong>Pos Edge:</strong> PosEdge is similar to WorkingEdge and is used while calculating bid and offer price. This
will be added to ask price to get the good ask price. And will subtracted from bid price to get a good
bid price. It is used both while entering and exiting a position and proportionately based on the poistion
acquired.</p>
</li>
<li><p class="first"><strong>Entry Rounding Mode and Exit Rounding Mode:</strong> EntryRoundingMode and ExitRoundingMode can contain one of the
following four values 0 –
PRESERVE 1 = ADD, 2 = REDUCE 3 = DONT_ROUND, Valid values for EntryRoundingMode is 0, 1, and 3. And Valid values
for ExitRoundingMode is 0, 1, 2, 3 EntryRoundingMode and ExitRoundingMode work together as a pair. Default value
of EntryRoundingMode is 1 and ExitRoundingMode is 0.</p>
<p>Example: Assume book contains following quantity on the bid
and offer side (100 100 — 100 100) If a sell of 70 partially fills bid side leaving 30 residual, the book will
look as follows (100 100 — 30 100) Now, if the rounding mode is set as follows</p>
<ol class="arabic simple">
<li>EntryRoundingMode = 0, &amp;
ExitRoundingMode = 0 (PRESERVE_PRESERVE), No Orders will be placed, the book will look as follows (100 100 —
30 100)</li>
<li>EntryRoundingMode = 1, &amp; ExitRoundingMode = 0 (ADD_PRESERVE), An order will be sent to replenish the
Bid side, the book will look as follows (100 100 — 30+100 100)</li>
<li>EntryRoundingMode = 1, &amp; ExitRoundingMode = 2 (ADD_REDUCE), An order will be sent to replenish the Bid
side and reduce the Offer side by 30, the book will look as follows (100 70 — 30+100 100)</li>
<li>EntryRoundingMode = 0, &amp; ExitRoundingMode = 2 (PRESERVE_REDUCE), An
order will be sent to reduce the Offer side by 30, the book will look as follows (100 70 — 30 100)</li>
<li>EntryRoundingMode = 0, &amp; ExitRoundingMode = 3 (PRESERVE_ADD), An order will be sent to replenish the Offer
side, the book will look as follows (100 100+70 — 30 100)</li>
<li>EntryRoundingMode = 3, &amp; ExitRoundingMode = 3
(ADD_ADD), An order will be sent to replenish the Bid and Offer side, the book will look as follows (100 100+70
— 30+100 100)</li>
</ol>
</li>
<li><p class="first"><strong>Exit Column Mode:</strong> ExitColumnMode is used while Hedging. Valid values for ExitColumnMode are 0, 1, and 2.
Below are the description of each value 0 = None, 1 = INSIDE_ONLY, 2 = ALL_LEVELS, The Value 0 disables exit column
mode, 1 means the order will only place on the inside level (level 0) and 2 means orders will be placed on all price
levels.</p>
</li>
<li><p class="first"><strong>Portfolio Pos Edge:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> default value of this parameter is 0.</p>
</li>
<li><p class="first"><strong>Portfolio Pos Denominator:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> default value of this parameter is 0.</p>
</li>
<li><p class="first"><strong>Portfolio Beta:</strong> !!!!! <strong>TO BE IMPLEMENTED, do not change</strong> default value of this parameter is 1.0.</p>
</li>
<li><p class="first"><strong>Adding Order Type:</strong> AddingOrderType specifies the type of the Order that the trading column would create.
Valid values for this parameter are ‘ALO’ (Add Liquidity Only), ‘LIMIT’, and ‘MARKET’.</p>
</li>
<li><p class="first"><strong>Max Edge:</strong> MaxEdge indicates maximum effective value for entry and exit edges. If the effective entry/exit
edge reaches MaxEdge and the net position is greater than zero, then the orders will be canceled.</p>
</li>
<li><p class="first"><strong>Max Price Imporvement:</strong> MaxPriceImprovement is used to determine the bid and ask price. If MaxPriceImprovement
is set to 0, then the trading column will join the best bid/offer price, regardless of how much the valuation price
is through the book. If MaxPriceImprovement is greater than 0, then the trading column will be allowed to cross the
best bid/offer price by MaxPriceImprovement times the EdgeUnitsPerTick. If MaxPriceImprovement is set to -1 (or less
than 0), then MaxPriceImprovement feature will be disabled, the bid and ask price will be allowed to cross the best
bid and offer regardless how far it is through the book.</p>
</li>
<li><p class="first"><strong>Min Join Volume:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> Default value
for this parameter is 100.</p>
</li>
<li><p class="first"><strong>Order Delay:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> Default value
for this parameter is 0.</p>
</li>
<li><p class="first"><strong>Min Order Hit rate:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> Default
value for this parameter is 500. This was originally used with removal price but not used any more.</p>
</li>
<li><p class="first"><strong>Removal Entry Edge:</strong> <strong>TO BE IMPLEMENTED, do not change</strong>
The default value of this parameter is 100.</p>
</li>
<li><p class="first"><strong>Removal Exit Edge:</strong> <strong>TO BE IMPLEMENTED, do not change</strong>
The default value of this parameter is 100.</p>
</li>
<li><p class="first"><strong>Removal Order Type:</strong> <strong>TO BE IMPLEMENTED, do not change</strong>
The default value of this parameter is ‘IOC’.</p>
</li>
<li><p class="first"><strong>Cancel Delay:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> Default value
for this parameter is 0.</p>
</li>
<li><p class="first"><strong>Pair Beta:</strong> PairBeta is used by Pair Trading Column. It provides hedge ratio. The ratio is positive is the pair
is directly proportional to this trading column. Default value of this parameter is 1.0</p>
</li>
<li><p class="first"><strong>Pair Denom:</strong> PairDenom is used by PairTradingColumn. This is used along with PairEdge. Effecive pair edge that the
column calculates will be divided by this value before it gets applied.</p>
</li>
<li><p class="first"><strong>Pair Edge:</strong> PairEdge is used by PairTradingColumn. This is an additional edge during hedging.</p>
</li>
<li><p class="first"><strong>Bids Only:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> Default value
of this parameter is False.</p>
</li>
<li><p class="first"><strong>Asks Only:</strong> <strong>TO BE IMPLEMENTED, do not change</strong> Default value of
this parameter is False.</p>
</li>
<li><p class="first"><strong>Pair Column Type:</strong> This parameter is used to specify the trading column type. Following are valid values
for this parameter 0, 1, 2, 3, 4, and 5. Below are the description of each value.
0 = NON_PAIR, 1 = ENTER_LONG, 2 = ENTER_SHORT, 3 = EXIT_LONG, 4 = EXIT_SHORT, 5 = NON_PAIR_EXIT_ONLY
Value 0 is used for creating TwoSidedMarketMaking
trading column.</p>
<ul class="simple">
<li>Value 1 is used by trading column specifically for entering long position. When PairBeta is greater
than or equal to zero, LessLiquidBidAsk trading column will be created. When PairBeta is less than zero
LessLiquidBidBid trading column will be created.</li>
<li>Value 2 is used by trading column for entering short position.
When PairBeta is greater than or equal to zero, LessLiquidAskBid trading column will be created. When PairBeta is
less than zero LessLiquidAskAsk trading column will be created.</li>
<li>Value 3 is used by trading column for exiting
long position. When PairBeta is greater than or equal to zero, OfferHedgingBid trading column will be created.
When PairBeta is less than zero OfferHedgingOffer trading column will be created.</li>
<li>Value 4 is used by trading
column for exiting short position. When PairBeta is greater than or equal to zero, BidHedgingOffer trading column
will be created. When PairBeta is less than zero BidHedgingBid trading column will be created.</li>
<li>Value 5 is used for
creating a Non Pair Exit only trading column.</li>
</ul>
</li>
<li><p class="first"><strong>Startegy:</strong> This is a string that provides a short description about the strategy. Used for administration purposes.</p>
</li>
<li><p class="first"><strong>Trading Enabled:</strong> Orders will be processed for this trading column only when this parameter is set to True.
Default value of this parameter is True</p>
</li>
<li><p class="first"><strong>Order Venue:</strong> Order Venue and Order Symbol specifies the Exchange and Symbol for which this trading column will
generate orders. OrderVenue should be configured as NSDQ for now.</p>
</li>
<li><p class="first"><strong>Order Symbol:</strong> Order Venue and Order Symbol specifies the Exchange and Symbol for which this trading column will
generate orders. OrderVenue should be configured as NSDQ for now.</p>
</li>
<li><p class="first"><strong>Quote Venue:</strong> QuoteSymbol and QuoteVenue is the valuation symbol and the exchange providing this symbols market data.
This is used for valuation.</p>
</li>
<li><p class="first"><strong>Quote Symbol:</strong> QuoteSymbol and QuoteVenue is the valuation symbol and the exchange providing this symbols market data.
This is used for valuation.</p>
</li>
<li><p class="first"><strong>Pair Vanue and Pair Symbol:</strong> This is used in Pair Trading Column. It specifies Pair Venue and Pair Symbol while
creating Spread Strategy.</p>
</li>
</ul>
</div>
<div class="section" id="valuation-functions">
<span id="valuationfunc"></span><h2><strong>Valuation Functions</strong><a class="headerlink" href="#valuation-functions" title="Permalink to this headline">¶</a></h2>
<p>Valuation Functions are the most important part of your model as they will dictate the price
at which orders will be placed to buy and sell.</p>
<p>The model runs your valuation function continuously and extremely quickly in order to always have the
correct price.</p>
<p>It is up to you to determine how you want that price to be calculated.</p>
<p>Write the valuation function using the DSL <a class="reference internal" href="atomlib.html#al"><span class="std std-ref">Alpha Trading Labs DSL</span></a> which will enable you to access and manipulate real
time market data on trades and quotes leading to an accurate price calculation.</p>
<ul class="simple">
<li><strong>Note on how valuation functions work in the model:</strong> Valuation functions and the DSL work around <a class="reference internal" href="atomlib.html#events"><span class="std std-ref">Events</span></a>
nodes, mainly <a class="reference internal" href="atomlib.html#trade"><span class="std std-ref">Trade</span></a> and <a class="reference internal" href="atomlib.html#quote"><span class="std std-ref">Quote</span></a> where you will create a Trade and/or Quote variable for a given
security symbol which will continuously update based on real market data. The valuation function is run continuously
where certain lines of code will only run if in that ‘cycle’ of the valuation function the event that happened
most recently is used in that line of code. To understand more about what this implies read through the rest of
the MP2 example and <a class="reference internal" href="#whyusehold"><span class="std std-ref">Why Use Hold</span></a></li>
</ul>
<p>MP2 is the valuation used by default on the application, we will go through the function to give you
an idea about ways in which the DSL can be used. This should then allow you to create your own function
which caters to whatever goal you want your model to achieve.</p>
<p><em>Note: Your valuation function can be just ass, less, or more complicated as MP2. It is up to you to determine
what you want your valuation function to acomplish</em></p>
<div class="section" id="example-valuation-function-mp2">
<span id="egmp2"></span><h3><strong>Example Valuation Function MP2</strong><a class="headerlink" href="#example-valuation-function-mp2" title="Permalink to this headline">¶</a></h3>
<p>MP2 returns an EMA (Exponential Moving Average) of weighted trades. What this means is the price it outputs
is an average price which moves according to market data on trades, where more weight is given to the latest data.
So if a lot of time goes by before a new trade happens then the value loses weight as the time passes, then when a new
trade is registered the weight given to that data is much higher thus adjusting the price accordingly.</p>
<p><strong>Throughout the example you will find links to items that are part of the :ref:`AL`, read these in order to fully
understand how MP2 works as a valuation function in the Alpha Trading Labs model</strong></p>
<ul class="simple">
<li><em>italicized bullet points will serve as recommendations for when you write your valuation function</em></li>
</ul>
<p>Here is the function as a whole where we will look in detail how it reaches the price output.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">MP2</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">trade_weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">trade_weight_exp</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">trade_exp</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tau_halflife</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">):</span>

                <span class="sd">&quot;&quot;&quot;tau_halflife is in milliseconds&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Clock</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">Quote</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">trade</span> <span class="o">=</span> <span class="n">Trade</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Any</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">trade</span><span class="p">)</span>
        <span class="n">last_trade</span> <span class="o">=</span> <span class="n">Last</span><span class="p">(</span><span class="n">trade</span><span class="p">)</span>
        <span class="n">last_event_timestamp</span> <span class="o">=</span> <span class="n">Last</span><span class="p">(</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
        <span class="n">delta_time</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">-</span> <span class="n">last_event_timestamp</span>
        <span class="n">same_price</span> <span class="o">=</span> <span class="p">(</span><span class="n">trade</span><span class="o">.</span><span class="n">price</span> <span class="o">==</span> <span class="n">last_trade</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>
        <span class="n">decay</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">delta_time</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">tau_halflife</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">(</span><span class="n">trade</span><span class="o">.</span><span class="n">qty</span> <span class="o">**</span> <span class="n">trade_exp</span><span class="p">)</span>
        <span class="n">trade_price</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">(</span><span class="n">trade</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">WithInitial</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)(</span><span class="k">lambda</span> <span class="n">last</span><span class="p">:</span> <span class="n">Join</span><span class="p">(</span><span class="n">Filter</span><span class="p">(</span><span class="n">Any</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">decay</span> <span class="o">*</span> <span class="n">last</span><span class="p">),</span> <span class="n">Filter</span><span class="p">(</span><span class="n">Any</span><span class="p">(</span><span class="n">trade</span><span class="p">,</span> <span class="n">trade</span><span class="p">),</span> <span class="n">Select</span><span class="p">(</span><span class="n">same_price</span><span class="p">,</span> <span class="n">decay</span> <span class="o">*</span> <span class="n">last</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))))</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">((</span><span class="n">q</span><span class="o">.</span><span class="n">bid_price</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ask_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ask_price</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">bid_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">)))</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">((</span><span class="n">q</span><span class="o">.</span><span class="n">bid_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ask_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">))</span>
        <span class="n">weighted_trade_qty</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">((</span><span class="n">trade_weight</span> <span class="o">**</span> <span class="n">trade_weight_exp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="n">trade_exp</span><span class="p">))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">numerator</span> <span class="o">+</span> <span class="p">(</span><span class="n">trade_price</span> <span class="o">*</span> <span class="n">weighted_trade_qty</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">denominator</span> <span class="o">+</span> <span class="n">weighted_trade_qty</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>
</pre></div>
</div>
<p>MP2 looks at the trade data and creates a prices based of that data by assigning weight to it. In order to be
able to change the calculated weight it has a series of arguments which can be changed, but are assigned a
default value which will calculate prices with no extra weight. We will look at what each of these arguments do
as they come up.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">MP2</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">trade_weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">trade_weight_exp</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">trade_exp</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tau_halflife</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">):</span>
</pre></div>
</div>
<ul class="simple">
<li><em>It is a good idea to give your function a selection of arguments which can be changed, anything you may use
as multipliers, exponents, decays, which you might want to alter later. This way you can easily change the way
your model works by simply changing the arguments passed instead of writing a whole other function.
Assign them default values as well so you do not have to define them every time.</em></li>
<li><em>You will also want to include ‘symbol’ as an argument (always pass it the same symbol you set in your
trading column parameters).</em></li>
</ul>
<p>MP2 then initializes the <a class="reference internal" href="atomlib.html#events"><span class="std std-ref">Events</span></a> it will keep track of during the time that the model runs:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Clock</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">Quote</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">trade</span> <span class="o">=</span> <span class="n">Trade</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Any</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">trade</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, a <a class="reference internal" href="atomlib.html#clock"><span class="std std-ref">Clock</span></a> ‘c’ to keep track of a lack of events, <a class="reference internal" href="atomlib.html#quote"><span class="std std-ref">Quote</span></a> ‘q’ to have access to the book and any
changes to it for the  security symbol ‘symbol’ which you choose for your model, and <a class="reference internal" href="atomlib.html#trade"><span class="std std-ref">Trade</span></a> ‘trade’ to be able to
see the latest actual trades for the security symbol. ‘event’ uses <a class="reference internal" href="atomlib.html#any"><span class="std std-ref">Any</span></a> which will keep track of all three of these
such that it is now possible to know which of the three events was the most recent to have happened.</p>
<ul class="simple">
<li><em>at the beggening of your valuation function you will want to set up all the events you want to use to
calculate your price. Whether it be be only Quotes, Only Trades, or both like MP2 does.</em></li>
</ul>
<p>These events all have properties which can help calculate a price. For example, you can set up variables
using their attributes, which are important to your price calculation. MP2 sets up some variables
which will be important to the EMA calculation:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">last_trade</span> <span class="o">=</span> <span class="n">Last</span><span class="p">(</span><span class="n">trade</span><span class="p">)</span>
<span class="n">same_price</span> <span class="o">=</span> <span class="p">(</span><span class="n">trade</span><span class="o">.</span><span class="n">price</span> <span class="o">==</span> <span class="n">last_trade</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>
<span class="n">last_event_timestamp</span> <span class="o">=</span> <span class="n">Last</span><span class="p">(</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
<span class="n">delta_time</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">-</span> <span class="n">last_event_timestamp</span>
<span class="n">decay</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">delta_time</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">tau_halflife</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">(</span><span class="n">trade</span><span class="o">.</span><span class="n">qty</span> <span class="o">**</span> <span class="n">trade_exp</span><span class="p">)</span>
<span class="n">trade_price</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">(</span><span class="n">trade</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>
</pre></div>
</div>
<p>MP2 keeps track of the <a class="reference internal" href="atomlib.html#last"><span class="std std-ref">Last</span></a> trade that was executed, doing so in order to be able to calculate whether or
not the price has changed since the last trade and the most recent trade (‘same_price’).</p>
<p>It keeps track of the change in time between the most recent event to have occurred and the one before it using
<a class="reference internal" href="atomlib.html#timestamp"><span class="std std-ref">Timestamp</span></a> (‘delta_time’).</p>
<p>It sets up the decay value it will use later to determine the weight of values used in the final price
calculation. It is clear that the higher delta_time is the bigger decay’s value will be.
<em>Notice: tau_halflife is used here to calculate decay, where default is 1000, but can be changed
to either increase or decrease decay rate</em></p>
<p>It will <a class="reference internal" href="atomlib.html#hold"><span class="std std-ref">Hold</span></a> the weighted trade quantity <em>Notice: weight of trade quantity is determined by trade_exp which
can be changed and the default value is 1 meaning at default there is no extra weight attributed to quantity</em></p>
<p>Finally it will hold the trade price.</p>
<ul class="simple">
<li><em>you hold values for event attributes that will be used in calculations because it is possible that for any
given ‘cycle’ in which the valuation function is run there might not be a new trade so for example trade.price
would not execute that cycle, but by holding trade.price you ensure that you have available to you the most
recent price in every ‘cycle’ of the valuation function to use in your calculation.</em></li>
</ul>
<p>Now that the events and these values are set up we are ready to make the calculations</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">WithInitial</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)(</span><span class="k">lambda</span> <span class="n">last</span><span class="p">:</span> <span class="n">Join</span><span class="p">(</span><span class="n">Filter</span><span class="p">(</span><span class="n">Any</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">decay</span> <span class="o">*</span> <span class="n">last</span><span class="p">),</span> <span class="n">Filter</span><span class="p">(</span><span class="n">Any</span><span class="p">(</span><span class="n">trade</span><span class="p">,</span> <span class="n">trade</span><span class="p">),</span> <span class="n">Select</span><span class="p">(</span><span class="n">same_price</span><span class="p">,</span> <span class="n">decay</span> <span class="o">*</span> <span class="n">last</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))))</span>
<span class="n">numerator</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">((</span><span class="n">q</span><span class="o">.</span><span class="n">bid_price</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ask_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ask_price</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">bid_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">)))</span>
<span class="n">denominator</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">((</span><span class="n">q</span><span class="o">.</span><span class="n">bid_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ask_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">))</span>
<span class="n">weighted_trade_qty</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">((</span><span class="n">trade_weight</span> <span class="o">**</span> <span class="n">trade_weight_exp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="n">trade_exp</span><span class="p">))</span>
<span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">numerator</span> <span class="o">+</span> <span class="p">(</span><span class="n">trade_price</span> <span class="o">*</span> <span class="n">weighted_trade_qty</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">denominator</span> <span class="o">+</span> <span class="n">weighted_trade_qty</span><span class="p">)</span>
<span class="k">return</span> <span class="n">v</span>
</pre></div>
</div>
<ul class="simple">
<li><em>These are some really good examples of how to use the :ref:`AL` in order to manipulate data.</em></li>
</ul>
<p>We will look at these calculations line by line:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">WithInitial</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)(</span><span class="k">lambda</span> <span class="n">last</span><span class="p">:</span> <span class="n">Join</span><span class="p">(</span><span class="n">Filter</span><span class="p">(</span><span class="n">Any</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">decay</span> <span class="o">*</span> <span class="n">last</span><span class="p">),</span> <span class="n">Filter</span><span class="p">(</span><span class="n">Any</span><span class="p">(</span><span class="n">trade</span><span class="p">,</span> <span class="n">trade</span><span class="p">),</span> <span class="n">Select</span><span class="p">(</span><span class="n">same_price</span><span class="p">,</span> <span class="n">decay</span> <span class="o">*</span> <span class="n">last</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))))</span>
</pre></div>
</div>
<p>The first line is assigning to ‘y’ the calculated decayed trade quantity value. Doing so by using <a class="reference internal" href="atomlib.html#withinitial"><span class="std std-ref">WithInitial</span></a>
Where it will assign 0.0 to ‘last’ where last in a sense holds the value for the next ‘cycle’. It then runs the anonymous
lambda function proceeding it. (It is recommended to see the <a class="reference internal" href="atomlib.html#withinitial"><span class="std std-ref">WithInitial</span></a> documentation)</p>
<p>Within the lambda function we find a <a class="reference internal" href="atomlib.html#join"><span class="std std-ref">Join</span></a> with two <a class="reference internal" href="atomlib.html#filter"><span class="std std-ref">Filter</span></a> arguments:</p>
<p><strong>…Join(Filter(Any(c, q), decay * last), Filter(Any(trade, trade), Select(same_price, decay * last + x, x))))</strong></p>
<p>the first filter will check if the <a class="reference internal" href="atomlib.html#any"><span class="std std-ref">Any</span></a> is true, in other words if either c or q are the most recent events
(remember c is the <a class="reference internal" href="atomlib.html#clock"><span class="std std-ref">Clock</span></a> and q is the <a class="reference internal" href="atomlib.html#quote"><span class="std std-ref">Quote</span></a> we initialized at the beginning), if they are then return
decay * last (the value is assigned ‘last’ as well as ‘y’)</p>
<p><strong>…Join(Filter(Any(c, q), decay * last)…</strong></p>
<p>remember we created the value of decay before, so what this does is if there was no trade then decay the current value
of last. For every continuous cycle where there is no trade the value of last is decayed more and more</p>
<ul class="simple">
<li><em>Using Any in this context as an argument for will check if any of the events passed as it’s arguments
are the most recent event. You can think of it as returning True or False (although it’s not quite doing that,
but we don’t need to worry about that)</em></li>
</ul>
<p>The second filter also uses Any but notice it has trade twice, mainly because it requires two arguments. The purpose
of this is that this filter will execute only if there has been a trade as the most recent event for this cycle of
the valuation function. If that is the case then it will return the <a class="reference internal" href="atomlib.html#select"><span class="std std-ref">Select</span></a>:</p>
<p><strong>Filter(Any(trade, trade), Select(same_price, decay * last + x, x))))</strong></p>
<p>What this select does is check if the value same_price (which we defined earlier) is true.
* if true then return decay * last + x which is the decayed value of x plus the weighted trade quantity stored in x.
* if false return x (the weighted trade quantity)
The value is then assigned to ‘last’ to be stored and ‘y’ to be used</p>
<p><strong>Select(same_price, decay * last + x, x)</strong></p>
<p>So what this entire line does in essence is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">WithInitial</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)(</span><span class="k">lambda</span> <span class="n">last</span><span class="p">:</span> <span class="n">Join</span><span class="p">(</span><span class="n">Filter</span><span class="p">(</span><span class="n">Any</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">decay</span> <span class="o">*</span> <span class="n">last</span><span class="p">),</span> <span class="n">Filter</span><span class="p">(</span><span class="n">Any</span><span class="p">(</span><span class="n">trade</span><span class="p">,</span> <span class="n">trade</span><span class="p">),</span> <span class="n">Select</span><span class="p">(</span><span class="n">same_price</span><span class="p">,</span> <span class="n">decay</span> <span class="o">*</span> <span class="n">last</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))))</span>
</pre></div>
</div>
<ul class="simple">
<li>when initialized returns the value 0.0 if no trade has happened yet.</li>
<li>Once a trade happens for the first time it will return the weighted trade quantity x</li>
<li>At that point onward if there is a new trade it will again return the weighted trade quantity</li>
<li>if however there was no trade then the weighted trade quantity is decayed</li>
<li>every continous cycle there is no new trade the weighted trade quantity is decayed further</li>
<li>If there was a new trade event but the price did not change then the weighted trade quantity is decayed but
the most recent weighted trade quantity is taken into account</li>
</ul>
<p>This will allow to calculate the price using a weighted trade quantity which is decayed due to no new trades or
changes in prices happening.</p>
<p>Now we calculate the first part of the numerator by cross multiplying and adding the bid price and ask quantity
with ask price and bid quantity and hold the value, as such:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">numerator</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">((</span><span class="n">q</span><span class="o">.</span><span class="n">bid_price</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ask_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ask_price</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">bid_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">)))</span>
</pre></div>
</div>
<p>The first part of the denominator will be calculates by adding weight to bid quantity with an exponent ‘exp’
(which is one of the function arguments, default is 1.0 so if you want more weight change this value) and adding
that with the ask quantity also to the power of ‘exp’and hold it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">denominator</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">((</span><span class="n">q</span><span class="o">.</span><span class="n">bid_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ask_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">))</span>
</pre></div>
</div>
<p>Now we add more weight to our previously calculated weighted trade quantity ‘y’ by calculating the desired weight
‘trade_weight’ ** ‘trade_weight_exp’ (both function arguments that if left to default this will equal 1) and
multiplying that with ‘y’ to the power of ‘trade_exp’ (another function argument which by default is 1.0).
Unless the default arguments are changed, this will return ‘y’ our original weighted trade quantity.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">weighted_trade_qty</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">((</span><span class="n">trade_weight</span> <span class="o">**</span> <span class="n">trade_weight_exp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="n">trade_exp</span><span class="p">))</span>
</pre></div>
</div>
<p>Finally to calculate the price we add the numerator to the trade price multiplied by the weighted trade quantity
and divide that by the denominator plus the weighted trade quantity.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">numerator</span> <span class="o">+</span> <span class="p">(</span><span class="n">trade_price</span> <span class="o">*</span> <span class="n">weighted_trade_qty</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">denominator</span> <span class="o">+</span> <span class="n">weighted_trade_qty</span><span class="p">)</span>
<span class="k">return</span> <span class="n">v</span>
</pre></div>
</div>
<p>This will return the desired price buy and sell orders will be placed based on an EMA of weighted trades.</p>
</div>
</div>
<div class="section" id="why-use-hold">
<span id="whyusehold"></span><h2><strong>Why Use Hold</strong><a class="headerlink" href="#why-use-hold" title="Permalink to this headline">¶</a></h2>
<p>The way the model compiles the code is special, in the sense that it revolves around <a class="reference internal" href="atomlib.html#events"><span class="std std-ref">Events</span></a>. Where
some code will not execute if the event it is addressing is not the most recent event in a given iteration or ‘cycle’</p>
<p>To illustrate this more using MP2 the following is the way in which the code is separated once the model is created
<em>Note: this is not how it is actually interpreted, but is a good way to visualize the idea of what is happening</em></p>
<p>MP2 can be thought to be separated like this:</p>
<ol class="arabic simple">
<li>The lines of code that are run once, which initialize event nodes:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Clock</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">Quote</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">trade</span> <span class="o">=</span> <span class="n">Trade</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Any</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">trade</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>The lines which will execute exclusively when the most recent event was a Trade:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">last_trade</span> <span class="o">=</span> <span class="n">Last</span><span class="p">(</span><span class="n">trade</span><span class="p">)</span>
<span class="n">same_price</span> <span class="o">=</span> <span class="p">(</span><span class="n">trade</span><span class="o">.</span><span class="n">price</span> <span class="o">==</span> <span class="n">last_trade</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">(</span><span class="n">trade</span><span class="o">.</span><span class="n">qty</span> <span class="o">**</span> <span class="n">trade_exp</span><span class="p">)</span>
<span class="n">trade_price</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">(</span><span class="n">trade</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>The lines which will execute exclusively when the most recent event was a Quote:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">numerator</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">((</span><span class="n">q</span><span class="o">.</span><span class="n">bid_price</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ask_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ask_price</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">bid_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">)))</span>
<span class="n">denominator</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">((</span><span class="n">q</span><span class="o">.</span><span class="n">bid_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ask_qty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp</span><span class="p">))</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>The lines which will execute every time since they use (or include a variable that contains) event or
Trade, Quote, and Clock:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">last_event_timestamp</span> <span class="o">=</span> <span class="n">Last</span><span class="p">(</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
<span class="n">delta_time</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">-</span> <span class="n">last_event_timestamp</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">WithInitial</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)(</span><span class="k">lambda</span> <span class="n">last</span><span class="p">:</span> <span class="n">Join</span><span class="p">(</span><span class="n">Filter</span><span class="p">(</span><span class="n">Any</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">decay</span> <span class="o">*</span> <span class="n">last</span><span class="p">),</span> <span class="n">Filter</span><span class="p">(</span><span class="n">Any</span><span class="p">(</span><span class="n">trade</span><span class="p">,</span> <span class="n">trade</span><span class="p">),</span> <span class="n">Select</span><span class="p">(</span><span class="n">same_price</span><span class="p">,</span> <span class="n">decay</span> <span class="o">*</span> <span class="n">last</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))))</span>
<span class="n">weighted_trade_qty</span> <span class="o">=</span> <span class="n">Hold</span><span class="p">((</span><span class="n">trade_weight</span> <span class="o">**</span> <span class="n">trade_weight_exp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="n">trade_exp</span><span class="p">))</span>
<span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">numerator</span> <span class="o">+</span> <span class="p">(</span><span class="n">trade_price</span> <span class="o">*</span> <span class="n">weighted_trade_qty</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">denominator</span> <span class="o">+</span> <span class="n">weighted_trade_qty</span><span class="p">)</span>
<span class="k">return</span> <span class="n">v</span>
</pre></div>
</div>
<p>It is now easy to see why <a class="reference internal" href="atomlib.html#hold"><span class="std std-ref">Hold</span></a> is useful, because in the lines that execute every time (the lines which
actually calculate the price and return it) they use x, trade_price, numerator, and denominator, all variables
that only run during trade or quote cycles but not both. Hold allows these calculations to be made every time
regardless of the most recent event. This is an important attribute for the valuation function to have, as you
want to always be able to produce the price at which you  want your orders placed.</p>
</div>
<div class="section" id="go-to">
<h2>Go To<a class="headerlink" href="#go-to" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="index.html#home"><span class="std std-ref">Using Alpha Trading Labs</span></a></li>
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo.jpeg" alt="Logo"/>
    
  </a>
</p>









<h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>Getting Started</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tutorial"><strong>Tutorial</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-aquainted"><strong>Getting Aquainted</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#understanding-the-model"><strong>Understanding the Model</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-multiple-models-at-once"><strong>Create Multiple Models at Once</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-your-own-valuation-function"><strong>Use your own Valuation Function</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#save-and-find-your-models"><strong>Save and Find Your Models</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#what-the-results-summary-means"><strong>What the Results Summary Means</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-parameters"><strong>Model Parameters</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#trading-column-parameters"><strong>Trading Column Parameters</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#valuation-functions"><strong>Valuation Functions</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-valuation-function-mp2"><strong>Example Valuation Function MP2</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#why-use-hold"><strong>Why Use Hold</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#go-to">Go To</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="atomlib.html"><strong>Alpha Trading Labs DSL</strong></a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="marketlib.html"><strong>Marketlib</strong></a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter"><strong>Using Alpha Trading Labs</strong></a></li>
      <li>Next: <a href="atomlib.html" title="next chapter"><strong>Alpha Trading Labs DSL</strong></a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Alpha Trading Labs.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/tutorial.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>